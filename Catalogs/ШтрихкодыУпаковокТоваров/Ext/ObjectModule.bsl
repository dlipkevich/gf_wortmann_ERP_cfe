#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

&ИзменениеИКонтроль("ЗаполнениеСлужебныхПолейДляGS1")
Процедура гф_ЗаполнениеСлужебныхПолейДляGS1()

	// Только для типов штрихкодов GS1_128 и GS1_DataBarExpandedStacked, для SSCC и Code-128 в ЕГАИС формат штрихкода жестко установлен
	Если ТипШтрихкода = Перечисления.ТипыШтрихкодов.GS1_128
		Или ТипШтрихкода = Перечисления.ТипыШтрихкодов.GS1_DataBarExpandedStacked
		Или ТипШтрихкода = Перечисления.ТипыШтрихкодов.GS1_DataMatrix Тогда

		Если ЭтоНовый() Тогда
			ОбновитьРеквизитыGS1 = (ЗначениеЗаполнено(ЗначениеШтрихкода) И Не ЗначениеЗаполнено(ХешСуммаНормализации));
		Иначе
			ОбновитьРеквизитыGS1 = ЗначениеШтрихкода <> ОбщегоНазначения.ЗначениеРеквизитаОбъекта(Ссылка, "ЗначениеШтрихкода");
		КонецЕсли;

		Если ОбновитьРеквизитыGS1 Тогда

			ПараметрыШтрихкода = ШтрихкодыУпаковокКлиентСервер.ПараметрыШтрихкода(ЗначениеШтрихкода);
			Результат          = ПараметрыШтрихкода.Результат;

			ХешСуммаНормализации = "";

			Если Результат <> Неопределено Тогда

				НомерПартии   = "";
				СерийныйНомер = 0;

				Если ПараметрыШтрихкода.ТипШтрихкода <> Перечисления.ТипыШтрихкодов.SSCC Тогда

					Для Каждого СвойствоШтрихкода Из Результат Цикл
						#Вставка
						// #wortmann {
						// Галфинд Sakovich 2022/10/10
						Если ТипЗнч(Результат) = Тип("Структура") И Результат.Свойство("ИмяИдентификатора") Тогда
						// } #wortmann
						#КонецВставки
						Если СвойствоШтрихкода.ИмяИдентификатора = ВРег("НомерПартии") Тогда
							НомерПартии = СвойствоШтрихкода.Значение;
						ИначеЕсли СвойствоШтрихкода.ИмяИдентификатора = ВРег("СерийныйНомер") Тогда
							СерийныйНомер = СвойствоШтрихкода.Значение;
						КонецЕсли;
						#Вставка
						// #wortmann {
						// Галфинд Sakovich 2022/10/10
						КонецЕсли;
						// } #wortmann
						#КонецВставки
						Если ЗначениеЗаполнено(НомерПартии) И ЗначениеЗаполнено(СерийныйНомер) Тогда
							Прервать;
						КонецЕсли;
					КонецЦикла;

				КонецЕсли;

				Справочники.ШтрихкодыУпаковокТоваров.ЗаполнитьСвойствоХешСуммаЗначенияШтрихкода(ЭтотОбъект, ПараметрыШтрихкода);

			КонецЕсли;

		КонецЕсли;

	Иначе

		Если ЗначениеЗаполнено(ХешСуммаНормализации) И Не ЭтоНовый()
			И ЗначениеШтрихкода <> ОбщегоНазначения.ЗначениеРеквизитаОбъекта(Ссылка, "ЗначениеШтрихкода") Тогда
			ХешСуммаНормализации = "";
		КонецЕсли;

		НомерПартии   = "";
		СерийныйНомер = 0;

	КонецЕсли;

КонецПроцедуры

#КонецЕсли